# ==============================================
# BACKEND - Express.js Environment Variables
# ==============================================
# Copy this file to .env for development
# NEVER commit .env to version control

# ----------------------------------------------
# APPLICATION SETTINGS
# ----------------------------------------------
NODE_ENV=development
PORT=5000
API_VERSION=v1

# ----------------------------------------------
# FRONTEND URL (for CORS)
# ----------------------------------------------
FRONTEND_URL=http://localhost:3000

# ----------------------------------------------
# DATABASE - MongoDB
# ----------------------------------------------
# For local development:
# MONGODB_URI=mongodb://admin:admin123@localhost:27017/tinyurl?authSource=admin

# For remote MongoDB (IONOS VPS):
MONGODB_URI=mongodb://root:D5LXII0FnAzFvvXN7NsJsDsdQKFvA4e46GpDsT1vik6eLxLQgS3C7vYF5bQ7gTD8@66.179.240.208:54455/?directConnection=true

MONGO_USER=root
MONGO_PASSWORD=D5LXII0FnAzFvvXN7NsJsDsdQKFvA4e46GpDsT1vik6eLxLQgS3C7vYF5bQ7gTD8
MONGO_DB_NAME=tinyurl

# Connection pool settings (optimized for remote connections)
MONGO_POOL_SIZE=10
MONGO_SOCKET_TIMEOUT=45000
MONGO_SERVER_SELECTION_TIMEOUT=30000

# ----------------------------------------------
# CACHE - Redis
# ----------------------------------------------
# Enable/disable Redis caching (set to false to run without Redis)
# If Redis connection fails, app will automatically continue without caching
REDIS_ENABLED=true

# For local development:
# REDIS_URL=redis://localhost:6379
# REDIS_HOST=localhost
# REDIS_PORT=6379
# REDIS_PASSWORD=redis123

# For remote Redis (IONOS VPS):
REDIS_URL=redis://default:wCqeopzucPtdE9vw8hadFuc5wpPIMVg3r6kFs1d2cQxkxg3cZxWkKptgcFR4iEI0@66.179.240.208:5900/0
REDIS_HOST=66.179.240.208
REDIS_PORT=5900
REDIS_PASSWORD=wCqeopzucPtdE9vw8hadFuc5wpPIMVg3r6kFs1d2cQxkxg3cZxWkKptgcFR4iEI0
REDIS_DB=0

# Redis connection settings (optimized for remote connections)
REDIS_MAX_RETRIES=5
REDIS_RETRY_DELAY=2000

# Cache TTL settings (in seconds)
CACHE_TTL_SHORT=300
CACHE_TTL_MEDIUM=3600
CACHE_TTL_LONG=86400

# ----------------------------------------------
# AUTHENTICATION - JWT
# ----------------------------------------------
# IMPORTANT: Generate strong secrets in production
# Generate with: openssl rand -base64 64
JWT_SECRET=your-super-secret-jwt-key-change-in-production-min-32-chars
JWT_REFRESH_SECRET=your-super-secret-refresh-key-change-in-production-min-32-chars
JWT_EXPIRES_IN=7d
JWT_REFRESH_EXPIRES_IN=30d
JWT_ISSUER=tinyurl-api
JWT_AUDIENCE=tinyurl-client

# ----------------------------------------------
# PASSWORD HASHING
# ----------------------------------------------
BCRYPT_ROUNDS=12

# ----------------------------------------------
# EMAIL SERVICE (SMTP)
# ----------------------------------------------
# Enable/disable email service
# Set to 'true' to enable email sending, 'false' to disable (emails will be logged to console)
# In development, keep this false unless you have configured Gmail App Password
# In production, set to true with valid SMTP credentials
ENABLE_EMAIL=false

EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_SECURE=false
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-app-specific-password
EMAIL_FROM=noreply@tinyurl.com
EMAIL_FROM_NAME=TinyURL Clone

# Email templates
EMAIL_VERIFY_SUBJECT=Verify Your Email Address
EMAIL_RESET_PASSWORD_SUBJECT=Reset Your Password
EMAIL_WELCOME_SUBJECT=Welcome to TinyURL Clone

# ----------------------------------------------
# OAUTH - Google Authentication
# ----------------------------------------------
GOOGLE_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=your-google-client-secret
GOOGLE_CALLBACK_URL=http://localhost:5000/api/auth/google/callback
GOOGLE_SCOPE=profile email

# ----------------------------------------------
# OAUTH - GitHub Authentication
# ----------------------------------------------
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GITHUB_CALLBACK_URL=http://localhost:5000/api/auth/github/callback
GITHUB_SCOPE=user:email

# ----------------------------------------------
# PAYMENT GATEWAY - 2Checkout
# ----------------------------------------------
TWOCHECKOUT_MERCHANT_CODE=your-merchant-code
TWOCHECKOUT_SECRET_KEY=your-secret-key
TWOCHECKOUT_SANDBOX=true
TWOCHECKOUT_CURRENCY=USD

# Stripe (Alternative payment gateway)
STRIPE_SECRET_KEY=sk_test_your-stripe-secret-key
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# ----------------------------------------------
# RATE LIMITING
# ----------------------------------------------
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
RATE_LIMIT_SKIP_SUCCESS_REQUESTS=false

# Per-endpoint rate limits
RATE_LIMIT_AUTH_MAX=5
RATE_LIMIT_API_MAX=100
RATE_LIMIT_LINK_CREATE_MAX=50

# ----------------------------------------------
# LINK SHORTENING
# ----------------------------------------------
# SHORT LINK DOMAIN (where users will access short links)
# Development: Use localhost:5000 (backend server)
# Production: Use your production domain (e.g., shortlinks.co)
SHORT_DOMAIN=localhost:5000

SHORT_URL_LENGTH=7
CUSTOM_DOMAIN_ENABLED=true
DEFAULT_DOMAIN=localhost:3000
# Development domains (local)
ALLOWED_DOMAINS=localhost:3000,localhost:5000
# Production: Update with your production domains when deploying
# ALLOWED_DOMAINS=yourdomain.com,www.yourdomain.com

# URL validation
MAX_URL_LENGTH=2048
MIN_CUSTOM_SLUG_LENGTH=3
MAX_CUSTOM_SLUG_LENGTH=50
RESERVED_SLUGS=admin,api,auth,dashboard,docs,health,status

# Link expiration
LINK_DEFAULT_EXPIRY_DAYS=0
LINK_MAX_EXPIRY_DAYS=365

# ----------------------------------------------
# ANALYTICS
# ----------------------------------------------
ANALYTICS_ENABLED=true
ANALYTICS_RETENTION_DAYS=90
TRACK_USER_AGENT=true
TRACK_REFERRER=true
TRACK_LOCATION=true
TRACK_DEVICE=true
TRACK_BROWSER=true

# IP Geolocation service
IP_GEOLOCATION_ENABLED=true
IP_GEOLOCATION_API_KEY=your-ipgeolocation-api-key
IP_GEOLOCATION_PROVIDER=ipapi

# ----------------------------------------------
# QR CODE GENERATION
# ----------------------------------------------
QR_CODE_ENABLED=true
QR_CODE_SIZE=300
QR_CODE_ERROR_CORRECTION=M
QR_CODE_MARGIN=4
QR_CODE_FORMAT=png

# ----------------------------------------------
# FILE UPLOAD
# ----------------------------------------------
UPLOAD_ENABLED=true
UPLOAD_MAX_FILE_SIZE=5242880
UPLOAD_ALLOWED_TYPES=image/png,image/jpeg,image/jpg,image/svg+xml
UPLOAD_DESTINATION=./uploads

# ----------------------------------------------
# SECURITY
# ----------------------------------------------
# CORS CONFIGURATION
# Development (localhost)
CORS_ORIGIN=http://localhost:3000

# Docker Development (using service names)
# CORS_ORIGIN=http://frontend:3000,http://localhost:3000

# Production (IONOS VPS)
# CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com,http://yourdomain.com

ALLOWED_ORIGINS=http://localhost:3000,http://localhost:80

# Cookie settings
COOKIE_SECURE=false
COOKIE_HTTP_ONLY=true
COOKIE_SAME_SITE=lax
COOKIE_MAX_AGE=86400000

# Helmet.js security headers
HELMET_ENABLED=true

# CSRF Protection
CSRF_ENABLED=true

# ----------------------------------------------
# SESSION
# ----------------------------------------------
SESSION_SECRET=your-session-secret-change-in-production
SESSION_MAX_AGE=86400000
SESSION_ROLLING=true
SESSION_STORE=redis

# ----------------------------------------------
# LOGGING
# ----------------------------------------------
LOG_LEVEL=debug
LOG_FORMAT=json
LOG_FILE_ENABLED=true
LOG_FILE_PATH=./logs
LOG_FILE_MAX_SIZE=10485760
LOG_FILE_MAX_FILES=5

# Request logging
LOG_REQUESTS=true
LOG_RESPONSES=false

# ----------------------------------------------
# ADMIN
# ----------------------------------------------
ADMIN_EMAIL=admin@tinyurl.com
ADMIN_PASSWORD=ChangeThisPassword123!
ADMIN_USERNAME=admin

# ----------------------------------------------
# API DOCUMENTATION
# ----------------------------------------------
SWAGGER_ENABLED=true
SWAGGER_TITLE=TinyURL Clone API
SWAGGER_DESCRIPTION=API documentation for TinyURL Clone
SWAGGER_VERSION=1.0.0

# ----------------------------------------------
# WEBHOOKS
# ----------------------------------------------
WEBHOOK_ENABLED=true
WEBHOOK_MAX_RETRIES=3
WEBHOOK_RETRY_DELAY=5000

# ----------------------------------------------
# BACKGROUND JOBS
# ----------------------------------------------
JOB_QUEUE_ENABLED=true
# For remote Redis (IONOS VPS):
JOB_QUEUE_REDIS_HOST=66.179.240.208
JOB_QUEUE_REDIS_PORT=5900
# For local development:
# JOB_QUEUE_REDIS_HOST=localhost
# JOB_QUEUE_REDIS_PORT=6379

# Cleanup jobs
CLEANUP_EXPIRED_LINKS_ENABLED=true
CLEANUP_EXPIRED_LINKS_CRON=0 0 * * *

CLEANUP_OLD_ANALYTICS_ENABLED=true
CLEANUP_OLD_ANALYTICS_CRON=0 2 * * *

# ----------------------------------------------
# FEATURE FLAGS
# ----------------------------------------------
ENABLE_REGISTRATION=true
ENABLE_SOCIAL_LOGIN=true
ENABLE_EMAIL_VERIFICATION=true
ENABLE_TWO_FACTOR_AUTH=false
ENABLE_CUSTOM_DOMAINS=true
ENABLE_QR_CODES=true
ENABLE_ANALYTICS=true
ENABLE_API_DOCS=true
ENABLE_WEBHOOKS=true

# ----------------------------------------------
# THIRD-PARTY SERVICES
# ----------------------------------------------
# Sentry Error Tracking
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENVIRONMENT=development
SENTRY_TRACES_SAMPLE_RATE=1.0

# Cloudflare
CLOUDFLARE_API_KEY=your-cloudflare-api-key
CLOUDFLARE_ZONE_ID=your-zone-id
CLOUDFLARE_ENABLED=false

# AWS S3 (for file storage)
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_REGION=us-east-1
AWS_S3_BUCKET=tinyurl-uploads
AWS_S3_ENABLED=false

# SendGrid (Alternative email service)
SENDGRID_API_KEY=your-sendgrid-api-key
SENDGRID_ENABLED=false

# Twilio (for SMS 2FA)
TWILIO_ACCOUNT_SID=your-twilio-account-sid
TWILIO_AUTH_TOKEN=your-twilio-auth-token
TWILIO_PHONE_NUMBER=+1234567890
TWILIO_ENABLED=false

# ----------------------------------------------
# MONITORING
# ----------------------------------------------
HEALTH_CHECK_ENABLED=true
METRICS_ENABLED=true
PROMETHEUS_ENABLED=false
PROMETHEUS_PORT=9090

# ----------------------------------------------
# TESTING
# ----------------------------------------------
# For remote MongoDB testing (IONOS VPS - separate test database):
TEST_MONGODB_URI=mongodb://root:D5LXII0FnAzFvvXN7NsJsDsdQKFvA4e46GpDsT1vik6eLxLQgS3C7vYF5bQ7gTD8@66.179.240.208:54455/tinyurl_test?directConnection=true
TEST_REDIS_HOST=66.179.240.208
TEST_REDIS_PORT=5900
# For local development testing:
# TEST_MONGODB_URI=mongodb://admin:admin123@localhost:27017/tinyurl_test?authSource=admin
# TEST_REDIS_HOST=localhost
# TEST_REDIS_PORT=6379
